# CNC Telemetry ‚Äî Alert Rules Configuration
# Alertas s√£o avaliados a cada 30 segundos

alerts:
  # Regra 1: M√°quina parada por muito tempo
  - name: machine_stopped_long
    machine_id: "*"  # Todas as m√°quinas
    condition: |
      state == 'stopped' AND duration_seconds > 60
    severity: warning
    channels:
      - type: slack
        webhook: ${SLACK_WEBHOOK_URL}
        template: "üî¥ {machine_id} parada h√° {duration_min} min (Estado: stopped)"
      - type: webhook
        url: ${CUSTOM_WEBHOOK_URL}
        enabled: false
    
  # Regra 2: Execu√ß√£o sem movimento (anomalia cr√≠tica)
  - name: execution_no_movement
    machine_id: "*"
    condition: |
      rpm == 0 AND state == 'running'
    severity: critical
    duration_seconds: 60  # S√≥ alerta se persistir por 60s
    channels:
      - type: slack
        webhook: ${SLACK_WEBHOOK_URL}
        template: "‚ö†Ô∏è {machine_id} em execu√ß√£o mas SEM MOVIMENTO (RPM=0)"
    
  # Regra 3: RPM anormalmente baixo (opcional)
  - name: rpm_low_anomaly
    machine_id: "*"
    condition: |
      rpm > 0 AND rpm < 1000 AND state == 'running'
    severity: info
    enabled: false  # Desabilitado por padr√£o
    channels:
      - type: slack
        webhook: ${SLACK_WEBHOOK_URL}
        template: "‚ÑπÔ∏è {machine_id} com RPM baixo: {rpm} RPM"
    
  # Regra 4: Feed muito alto (poss√≠vel erro)
  - name: feed_too_high
    machine_id: "*"
    condition: |
      feed_mm_min > 2000
    severity: warning
    enabled: false  # Desabilitado por padr√£o
    channels:
      - type: slack
        webhook: ${SLACK_WEBHOOK_URL}
        template: "‚ö†Ô∏è {machine_id} com Feed ALTO: {feed_mm_min} mm/min"

# Configura√ß√£o global
global:
  dedupe_window_seconds: 60  # M√°ximo 1 alerta/min por regra
  evaluation_interval_seconds: 30  # Avaliar a cada 30s
  lookback_seconds: 120  # Buscar dados dos √∫ltimos 2 min
